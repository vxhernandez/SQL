Issue: Business Analysts and Developers reported that for one specific customer in the staging environment, 
multiple triggers were missing from the customerâ€™s schema. The DBA team was asked to analyze and resolve the issue.

Scope of Work
- Investigate missing triggers in the staging environment for a specific customer schema.
- Compare object counts between production template schema and staging copy schema.
- Identify missing triggers, extract DDL, and restore the objects.
- Validate that staging matches production after the fix.

Analysis
1. Compared object counts between SCHEMA_TEMPLATE and SCHEMA_COPY. Query used to identify discrepancies across object types.

SELECT 
    object_type,
    COUNT(CASE WHEN owner = 'SCHEMA_TEMPLATE' THEN 1 END) AS count_template,
    COUNT(CASE WHEN owner = 'SCHEMA_COPY' THEN 1 END) AS count_copy,
    ABS(
        COUNT(CASE WHEN owner = 'SCHEMA_TEMPLATE' THEN 1 END) -
        COUNT(CASE WHEN owner = 'SCHEMA_COPY' THEN 1 END)
    ) AS diff
FROM dba_objects
WHERE owner IN ('SCHEMA_TEMPLATE', 'SCHEMA_COPY')
GROUP BY object_type
ORDER BY object_type;

2. Query to identify missing triggers in staging.

SELECT 
    trigger_name,
    'Missing in SCHEMA_COPY' AS status
FROM all_triggers
WHERE owner = 'SCHEMA_TEMPLATE'
  AND trigger_name NOT IN (
        SELECT trigger_name 
        FROM all_triggers 
        WHERE owner = 'SCHEMA_COPY'
  )
ORDER BY trigger_name;

Trigger Extraction
Query to pull DDL for each missing trigger from production and replaced schema references so the objects could be recreated in staging.

SELECT 
    REPLACE(
        DBMS_METADATA.GET_DDL('TRIGGER', trigger_name, owner),
        'SCHEMA_TEMPLATE',
        'SCHEMA_COPY'
    ) AS trigger_ddl
FROM all_triggers
WHERE owner = 'SCHEMA_TEMPLATE'
  AND trigger_name NOT IN (
        SELECT trigger_name 
        FROM all_triggers 
        WHERE owner = 'SCHEMA_COPY'
  );

Resolution
- Exported trigger metadata from production using Data Pump.
- Updated schema references (batch-edited using vi).
- Imported the corrected trigger definitions into the staging schema.
- Re-ran the comparison queries to confirm:
- All missing triggers were successfully created.
- Object counts between production and staging were aligned.
